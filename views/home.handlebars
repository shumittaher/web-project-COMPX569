<div class="container">

    <div class="text-center p-5">

        <h1>
            Hello,

            {{#if user}}
                {{user.fullName}}
                {{else}}
                Guest User
            {{/if}}
        </h1>

        {{#if message}}
            <p>{{message}}</p>
        {{/if}}

    </div>
    <div id="post_form_area" class="shadow rounded border bg-light">

        {{#if user}}
            <button id="post_form_collapse" data-bs-toggle="collapse" data-bs-target="#post_form_form" class="btn text-start btn-primary btn-lg py-4 px-3 w-100">
                <span id="post_form_collapse_span" style="animation-direction:normal; width:100%" class="text-nowrap fs-3 text-center d-inline-block">
                   ‚úçÔ∏è New Post
                </span>
            </button>
        {{else}}
            <a href="/account/login">
                <button class="btn text-center btn-primary btn-lg py-4 px-3 w-100">
                    <span class="fs-3">
                       üîë Please log in to post
                    </span>
                </button>
            </a>
        {{/if}}

        <form id="post_form_form" action="/api/new" method="post" class = "bg-light collapse input_form">

            <hr>

            <div class="p-3" style="display: grid; row-gap: 1em;">

                <div class="form-group d-flex align-items-center">
                    <label for="title" class="mx-3 w-25 text-end">Title</label>
                    <input id="title" required class="form-control" autofocus type="text" name="title" maxlength="32" placeholder="Enter article title">
                </div>

                <div class="form-group d-flex align-items-start">
                    <label for="content" class="mx-3 w-25 text-end">Content</label>
                    <textarea id="content" required class="form-control" name="content" rows="10" placeholder="Write your article here..."></textarea>
                </div>

                <div class="form-group d-flex align-items-center">
                    <label for="image" class="mx-3 w-25 text-end">Upload Image</label>
                    <input id="image" class="form-control" type="file" name="image_path" accept="image/jpx, image/png, image/gif, image/bmp">
                    <small id="imageFeedback" class="form-text"></small>
                </div>
                <input type="hidden" name="parent_id" value="{{parent_id}}">

            </div>

            <input class="btn btn-primary btn-lg py-4" type="submit" value="üìù Publish">
        </form>

    </div>

    <div id="articles_area">
        {{> articles articles=articles}}
    </div>

</div >

<script>

    document.addEventListener('DOMContentLoaded', function() {

        const post_form_collapse = document.querySelector('#post_form_collapse')
        const post_form_collapse_span = document.querySelector('#post_form_collapse_span')
        const article_area = document.querySelector('#articles_area')

        post_form_collapse.addEventListener('click', ()=>{

            post_form_collapse.classList.toggle('btn-primary')
            post_form_collapse_span.style.width = post_form_collapse_span.style.width==='100%'?'0%':'100%'
            post_form_collapse_span.classList.toggle('animation_div_size')

        })

        post_form_collapse_span.addEventListener('animationend', ()=>{
            post_form_collapse_span.classList.toggle('animation_div_size')
            post_form_collapse_span.style.animationDirection = post_form_collapse_span.style.animationDirection==='normal'?'reverse':'normal'

        })

        async function fetchArticles() {
            try {
                const response = await fetch('/api/showArticles');
                console.log(response);
            } catch (error) {
                console.error('Error fetching articles:', error);
            }
        }

        fetchArticles();

    });


</script>


